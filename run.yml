---
- hosts: all
  become: yes
  gather_facts: no

  pre_tasks:
    - import_tasks: tasks/ssh_juggle_port.yml

- hosts: all
  become: yes
  gather_facts: yes

  tasks:
  - name: Requiring the list of services
    import_tasks: tasks/list_services.yml

  - name: Gathering information about proccessor architecture
    import_tasks: tasks/repo_arch.yml

  - name: Running the essential role
    include_role: 
      name: essential
      apply:
        tags:
          - essential
          
  - name: Setup geerlingguy security role
    include_role: 
      name: geerlingguy.security
      apply:  
        tags:
          - security

  - name: Run the DNS role
    include_role: 
      name: oefenweb.dns
      apply:  
        tags:
          - dns
  
  - name: Run geerlingguy pip role
    include_role:
      name: geerlingguy.pip
      apply:
        tags:
          - pip
          - python
          - docker

- hosts: raspberrypi
  become: yes
  gather_facts: yes

  tasks:

  - name: Run geerlingguy Docker arm role
    include_role:
      name: geerlingguy.docker_arm
      apply:
        tags:
          - docker

  - name: Icluding roles for simple tasks on machine without container
    import_tasks: tasks/include_role/simple_roles.yml
    when: enable_simple_roles | default(False)

  - name: Icluding container roles for system
    import_tasks: tasks/include_role/system_container.yml
    when: enable_systemcontainer_roles | default(False)

  - name: Icluding container roles for web
    import_tasks: tasks/include_role/web_container.yml
    when: enable_webcontainer_roles | default(False)

- hosts: quantumhome
  become: yes
  gather_facts: yes

  tasks:

  - name: Run geerlingguy Docker arm role
    include_role:
      name: geerlingguy.docker
      apply:
        tags:
          - docker

  - name: Icluding roles for simple tasks on machine without container
    import_tasks: tasks/include_role/simple_roles.yml
    when: enable_simple_roles | default(False)

  - name: Icluding container roles for system
    import_tasks: tasks/include_role/system_container.yml
    when: enable_systemcontainer_roles | default(False)

  - name: Icluding container roles for web
    import_tasks: tasks/include_role/web_container.yml
    when: enable_webcontainer_roles | default(False)

  - name: Run the role for homer
    include_role:
      name: homer
      apply:
        tags:
        - homer
        - docker
    when: enable_container_homer | default(False)

  #   ### Run this at the end, when the environment is set
  #   - role: viasite-ansible.zsh
  #     tags:
  #       - zsh

  # # - role: ironicbadger.ansible_role_snapraid
  # #   become: yes
  # #   tags:
  # #     - snapraid
  # #   when: host_has_persistent_data | default(False)

  # #
  # # homer
  # #
  # - role: homer
  #   become: no
  #   tags:
  #     - homer
  #     - containers
  #   when: enable_container_homer | default(False)
